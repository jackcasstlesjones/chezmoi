# Kernel Panic Analysis - Cascading Filesystem Failure

## Summary
The panic on 6.18.3 was NOT directly caused by the GPU issue, but rather by **EXT4 filesystem corruption from a hard power-off**.

## Root Cause Chain

1. **Primary Issue:** GPU suspend failure (VPE queue reset bug) caused system to become unresponsive
2. **Trigger:** User force shutdown with power button (hard shutdown without graceful unmount)
3. **Filesystem Damage:** EXT4 on nvme0n1p2 became corrupted due to unclean shutdown
4. **Cascading Failures on Reboot:**
   - EXT4 can't read directory blocks (inode #4718604): error -5 (I/O errors)
   - systemd-journald fails to write to journal: Input/output error
   - NetworkManager segfaults
   - systemd (init, PID 1) segfaults in libsystemd-shared-259-1.so
   - Kernel panic: "Attempted to kill init! exitcode=0x0b" (SIGSEGV)

## System Details
- Model: Lenovo 21QJCTO1WW (ThinkPad with Strix Point)
- BIOS: R2XET35W (1.15) from 08/29/2025
- Kernel: 6.18.3-arch1-1
- Storage: nvme0n1p2 (EXT4)

## Panic Log Snippet
[167068.264719] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264769] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264827] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264832] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264861] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264866] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264877] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167068.264888] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167070.514037] systemd-journald[433]: Failed to write entry to /var/log/journal/3e3ba1fa51d14fe985e87ce13e03b37d/system.journal (24 items, 624 bytes) despite vacuuming, ignoring: Input/output error (Dropped 5011 similar message(s)) [167072.764153] systemd-journald[433]: Failed to write entry to /var/log/journal/3e3ba1fa51d14fe985e87ce13e03b37d/system.journal (24 items, 624 bytes) despite vacuuming, ignoring: Input/output error (Dropped 5000 similar message(s)) [167073.264669] EXT4-fs warning: 25266 callbacks suppressed [167073.264675] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.264690] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.264699] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.264708] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265002] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265011] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265055] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265064] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265387] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167073.265395] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167075.014024] systemd-journald[433]: Failed to write entry to /var/log/journal/3e3ba1fa51d14fe985e87ce13e03b37d/system.journal (24 items, 624 bytes) despite vacuuming, ignoring: Input/output error (Dropped 5011 similar message(s)) [167077.265465] systemd-journald[433]: Failed to write entry to /var/log/journal/3e3ba1fa51d14fe985e87ce13e03b37d/system.journal (18 items, 413 bytes) despite vacuuming, ignoring: Input/output error (Dropped 5000 similar message(s)) [167078.763201] EXT4-fs warning: 24778 callbacks suppressed [167078.763207] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.763348] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.763378] systemd-journald[433]: Failed to write entry to /var/log/journal/3e3ba1fa51d14fe985e87ce13e03b37d/system.journal (26 items, 624 bytes) despite vacuuming, ignoring: Input/output error (Dropped 5000 similar message(s)) [167078.764151] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764214] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764261] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764268] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764390] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764408] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764433] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.764438] EXT4-fs warning (device nvme0n1p2): htree_dirblock_to_tree:1051: inode #4718604: lblock 0: comm systemd-journal: error -5 reading directory block [167078.914828] r8169 0000:c3:00.0 enp195s0f0: Link is Down [167079.012550] wlan0: deauthenticating from cc:58:30:b0:56:15 by local choice (Reason: 3=DEAUTH_LEAVING) [167079.324307] coredump: 993(NetworkManager): |/usr/lib/systemd/systemd-coredump pipe failed [167079.517040] systemd[1]: segfault at 7ffdd63e5ff8 ip 00007f8bd5e939f8 sp 00007ffdd63e6000 error 6 in libsystemd-shared-259-1.so[2939f8,7f8bd5c73000+317000] likely on CPU 6 (core 6, socket 0) [167079.517926] Code: 19 00 ba 38 00 00 00 48 8d 35 b7 d5 12 00 48 8d 3d 50 3b 16 00 48 89 e5 ff 15 8c 61 28 00 0f 1f 40 00 f3 0f 1e fa 55 48 89 e5 <53> 48 83 ec 18 48 85 ff 0f 84 92 01 00 00 48 8b 42 28 49 89 f1 49 [167079.518867] coredump: 1(systemd): |/usr/lib/systemd/systemd-coredump pipe failed [167079.518875] Kernel panic - not syncing: Attempted to kill init! exitcode=0x0000000b [167079.518884] CPU: 2 UID: 0 PID: 1 Comm: systemd Not tainted 6.18.3-arch1-1 #1 PREEMPT(full) 6c160025a96d7e55005d934f6ba2bcaf63591daa [167079.518889] Hardware name: LENOVO 21QJCTO1WW/21QJCTO1WW, BIOS R2XET35W (1.15 ) 08/29/2025 [167079.518892] Call Trace: [167079.518895] <TASK> [167079.518897] dump_stack_lvl+0x5d/0x80 [167079.518908] vpanic+0xdb/0x2d0 [167079.518914] panic+0x6b/0x6b [167079.518917] ? sched_mm_cid_before_execve+0xca/0x140 [167079.518924] ? vfs_coredump+0x541/0x2390 [167079.518929] do_exit.cold+0x58/0x58 [167079.518933] do_group_exit+0x2d/0xc0 [167079.518938] get_signal+0x81c/0x840 [167079.518944] ? x64_setup_rt_frame+0x6b/0x2f0 [167079.518948] arch_do_signal_or_restart+0x3f/0x270 [167079.518951] irqentry_exit_to_user_mode+0x1c7/0x260 [167079.518959] asm_exc_page_fault+0x26/0x30 [167079.518962] RIP: 0033:0x7f8bd5e939f8 [167079.519020] Code: 19 00 ba 38 00 00 00 48 8d 35 b7 d5 12 00 48 8d 3d 50 3b 16 00 48 89 e5 ff 15 8c 61 28 00 0f 1f 40 00 f3 0f 1e fa 55 48 89 e5 <53> 48 83 ec 18 48 85 ff 0f 84 92 01 00 00 48 8b 42 28 49 89 f1 49 [167079.519024] RSP: 002b:00007ffdd63e6000 EFLAGS: 00010202 [167079.519028] RAX: 00007f8bd6103240 RBX: 0000557542850ba0 RCX: 0000000000000000 [167079.519030] RDX: 00007ffdd63e6030 RSI: 0000000000000008 RDI: 00007ffdd63e6018 [167079.519032] RBP: 00007ffdd63e6000 R08: 00007ffdd63e6100 R09: 0000000000000000 [167079.519033] R10: 0000000000000005 R11: 11e2ff17dce64def R12: 0000000000000003 [167079.519035] R13: 0000000000000003 R14: 0000000000000003 R15: 0000000000000003 [167079.519039] </TASK> [167079.519618] Kernel Offset: 0x1de00000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
